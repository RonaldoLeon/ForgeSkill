{% extends 'usuario.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
    <h1>Bienvenido, {{ user.first_name }}</h1>
    {% if user.is_staff %}
        <a href="{% url 'admin_panel' %}" class="btn" style="padding:10px 15px;text-decoration:none;">‚öôÔ∏è Panel Admin</a>
    {% endif %}
</div>

<div class="flex">

    <div class="card" style="flex:1;">
        <h3>Proyectos Activos</h3>
        <p style="font-size:28px; font-weight:700;">{{ proyectos_activos }}</p>
    </div>

    <div class="card" style="flex:1;">
        <h3>Insignias</h3>
        <p style="font-size:28px; font-weight:700;">{{ insignias_count }}</p>
    </div>

    <div class="card" style="flex:1;">
        <h3>Progreso Total</h3>
        <div style="display:flex;align-items:center;gap:12px;">
            <div style="flex:1; background:#e9ecef; border-radius:8px; height:18px; overflow:hidden;">
                <div style="width:{{ progreso_total }}%; background:linear-gradient(90deg,#4caf50,#2ecc71); height:100%;"></div>
            </div>
            <div style="width:60px; text-align:right; font-weight:700;">{{ progreso_total }}%</div>
        </div>
    </div>

</div>

<h2 style="margin-top:30px;">Proyectos Recomendados</h2>

<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin-top:12px;">
    {% for proyecto in proyectos_recomendados %}
        <div class="card" style="padding:12px;">
            <div style="display:flex;gap:12px; align-items:center;">
                <div style="width:80px; height:60px; background:#f1f3f5; border-radius:6px; overflow:hidden; display:flex; align-items:center; justify-content:center;">
                    {% comment %} Si el modelo tuviera `imagen`, usar `proyecto.imagen.url` {% endcomment %}
                    <img src="{% static 'img/Imagen de WhatsApp 2025-09-09 a las 14.23.17_09f8b50d.jpg' %}" alt="Proyecto" style="width:100%; height:100%; object-fit:cover;">
                </div>
                <div style="flex:1;">
                    <div style="font-weight:700; font-size:16px;">{{ proyecto.nombre }}</div>
                    <div style="font-size:13px; color:#666;">{{ proyecto.dificultad }}</div>
                </div>
            </div>
            <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                <a href="{% url 'proyecto_detalle' proyecto.id %}" class="btn">Ver m√°s</a>
                <form method="post" action="{% url 'postular' proyecto.id %}" style="display:inline">{% csrf_token %}
                    <button type="submit" class="btn" style="background:#6c757d;" onclick="return confirm('¬øEnviar postulaci√≥n para este proyecto?');">Postular</button>
                </form>
            </div>
        </div>
    {% empty %}
        <p>No hay proyectos recomendados por el momento.</p>
    {% endfor %}
</div>

<h2 style="margin-top:28px;">Cat√°logo de Insignias</h2>
<div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:12px;">
    {% for ins in catalogo_insignias %}
        <div style="background:white; padding:10px 12px; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); display:flex; align-items:center; gap:10px;">
            <div style="width:40px; height:40px; background:#f8f9fa; border-radius:6px; display:flex; align-items:center; justify-content:center;">üèÖ</div>
            <div>
                <div style="font-weight:700;">{{ ins.nombre }}</div>
                <div style="font-size:12px; color:#666;">{% if ins.tiene %}Obtenida{% else %}No obtenida{% endif %}</div>
            </div>
        </div>
    {% empty %}
        <p>No hay insignias definidas.</p>
    {% endfor %}
</div>

{% endblock %}
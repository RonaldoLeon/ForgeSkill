<div class="chat-main">
    {% load user_tags %}
    <div class="chat-header">
        <div class="chat-header-avatar">{{ otro.username|first|upper }}</div>
        <div class="chat-header-info">
            <h2>{% user_link otro %}</h2>
            <p>@<a href="{% url 'public_profile_username' otro.username %}">{{ otro.username }}</a></p>
        </div>
        <a href="{% url 'notificaciones' %}" class="chat-header-action">â† AtrÃ¡s</a>
    </div>

    <div class="chat-messages" id="chatMessages">
        {% if mensajes %}
            {% for m in mensajes %}
                <div class="message-group {% if m.remitente.id == request.user.id %}sent{% else %}received{% endif %}">
                    <div class="message-bubble {% if m.remitente.id == request.user.id %}sent{% else %}received{% endif %}">
                        <div class="message-content">{{ m.contenido }}</div>
                        <div class="message-time">{{ m.fecha|date:"H:i" }}</div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-messages">
                <p>ğŸ’¬ Inicia la conversaciÃ³n</p>
                <small>Escribe tu primer mensaje para comenzar</small>
            </div>
        {% endif %}
        <div class="scroll-anchor" id="scrollAnchor"></div>
    </div>

    <div class="chat-input-area">
        <form method="POST" class="chat-form">
            {% csrf_token %}
            <input type="text" name="mensaje" placeholder="âœï¸ Escribe un mensaje..." required autofocus>
            <button type="submit">ğŸ“¤ Enviar</button>
        </form>
    </div>
</div>
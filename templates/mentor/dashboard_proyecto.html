{% extends 'usuario.html' %}
{% block title %}GestiÃ³n de Proyecto{% endblock %}

{% block content %}
<div class="header-proyecto">
    <h1>GestiÃ³n: {{ proyecto.nombre }}</h1>
    <div class="progreso-bar">
        <span style="width: {{ proyecto.progreso}}%;"></span>
    </div>
    <p>Progreso General: {{ proyecto.progreso }}%</p>
</div>

<div class="grid-container">
    
    <div class="columna">
        <div class="card">
            <h3>ğŸ‘¥ Solicitudes</h3>
            <table class="tabla-simple">
                {% for sol in solicitudes %}
                <tr>
                    <td>{{ sol.usuario.username }}</td>
                    <td>{{ sol.get_estado_display }}</td>
                    <td>
                        {% if sol.estado == 'pendiente' %}
                            <form method="post" action="{% url 'approve_solicitud' sol.id %}" style="display:inline">{% csrf_token %}
                                <button type="submit" class="btn-small btn-success" onclick="return confirm('Â¿Aprobar esta postulaciÃ³n?');">âœ“ Aprobar</button>
                            </form>
                            <form method="post" action="{% url 'reject_solicitud' sol.id %}" style="display:inline">{% csrf_token %}
                                <button type="submit" class="btn-small btn-danger" onclick="return confirm('Â¿Rechazar esta postulaciÃ³n?');">âœ— Rechazar</button>
                            </form>
                        {% else %}
                            <span style="font-size:13px;color:#888;">{{ sol.get_estado_display }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="3">No hay solicitudes.</td></tr>
                {% endfor %}
            </table>
        </div>

        <div class="card" style="margin-top:20px;">
            <h3>Participantes Activos</h3>
            <ul>
                {% for p in participantes %}
                <li>{{ p }} <a href="#" style="font-size:12px;">(Mensaje)</a></li>
                {% endfor %}
            </ul>
            <a href="{% url 'otorgar_insignia' %}" class="btn">ğŸ† Otorgar Insignia</a>
        </div>
    </div>

    <div class="columna" style="flex: 2;">
        <div class="card">
            <div style="display:flex; justify-content:space-between;">
                <h3>ğŸ“‹ Tablero de Tareas</h3>
                <button class="btn">+ Nueva Tarea</button>
            </div>
            
            <table class="tabla-completa">
                <thead>
                    <tr>
                        <th>Tarea</th>
                        <th>Asignado a</th>
                        <th>Estado</th>
                        <th>AcciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in tareas %}
                    <tr>
                        <td>{{ t.titulo }}</td>
                        <td>{{ t.asignado }}</td>
                        <td>
                            <span class="badge {{ t.estado }}">{{ t.estado }}</span>
                        </td>
                        <td><button class="btn-small">Editar</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<a href="{% url 'foro_proyecto' proyecto.id %}" class="btn" style="background: #673AB7;">
    ğŸ’¬ Chat del Equipo
</a>
{% endblock %}